<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Sign Up - Farmer Assistant</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container auth-container">
    <div class="header">
      <div class="h1"><span class="emoji">üìù</span> Farmer Assistant</div>
      <div class="small">Create your account</div>
    </div>

    <div class="auth-form">
      <h3 style="margin-top:0;margin-bottom:16px">Sign Up</h3>
      <label class="label">Username</label>
      <input id="username" class="input" type="text" placeholder="Choose a username" required>

      <label class="label">Email</label>
      <input id="email" class="input" type="email" placeholder="Your email" required>

      <label class="label">Phone</label>
      <input id="phone" class="input" type="tel" placeholder="Your phone number" required>

      <label class="label">Password</label>
      <input id="password" class="input" type="password" placeholder="Create a password" required>

      <label class="label">Confirm Password</label>
      <input id="confirmPassword" class="input" type="password" placeholder="Confirm password" required>

      <div style="display:flex;align-items:center;gap:8px;margin:8px 0">
        <input id="showPwd" type="checkbox"><label for="showPwd" class="small">Show password</label>
      </div>

      <button id="signupBtn" class="btn">‚úçÔ∏è Sign Up</button>

      <p class="small">Already have an account? <a href="login.html" class="link">Log in</a></p>
      <p class="small"><a href="index.html" class="link">Back to Home</a></p>
    </div>
  </div>

  <script>
    document.getElementById('showPwd').addEventListener('change', (e)=>{
      document.getElementById('password').type = e.target.checked ? 'text' : 'password';
      document.getElementById('confirmPassword').type = e.target.checked ? 'text' : 'password';
    });

    // CSV storage helpers (fields escaped with double-quotes)
    function escapeField(s){ return '"' + String(s).replace(/"/g,'""') + '"'; }
    function usersToCSV(users){
      const lines = ['username,password,phone,email'];
      for(const u in users){
        const row = [u, users[u].password||'', users[u].phone||'', users[u].email||'']
          .map(escapeField).join(',');
        lines.push(row);
      }
      return lines.join('\n');
    }
    function parseCSVRow(row){
      const fields = [];
      let cur = '';
      let inQuotes = false;
      for(let i=0;i<row.length;i++){
        const ch = row[i];
        if(inQuotes){
          if(ch === '"'){
            if(row[i+1] === '"') { cur += '"'; i++; }
            else { inQuotes = false; }
          } else cur += ch;
        } else {
          if(ch === ','){ fields.push(cur); cur=''; }
          else if(ch === '"'){ inQuotes = true; }
          else cur += ch;
        }
      }
      fields.push(cur);
      return fields;
    }
    function parseCSV(csv){
      const out = {};
      if(!csv) return out;
      const lines = csv.split(/\r?\n/);
      if(lines.length <= 1) return out;
      lines.shift(); // header
      for(const line of lines){
        if(!line.trim()) continue;
        const f = parseCSVRow(line);
        const username = f[0] || '';
        if(!username) continue;
        out[username] = { password: f[1]||'', phone: f[2]||'', email: f[3]||'' };
      }
      return out;
    }
    function loadUsers(){
      try { return parseCSV(localStorage.getItem('fa_users') || ''); }
      catch(e){ return {}; }
    }
    function saveUsers(users){
      try { localStorage.setItem('fa_users', usersToCSV(users)); }
      catch(e){ alert('Failed to save account. Storage may be full.'); }
    }

    document.getElementById('signupBtn').addEventListener('click', ()=>{
      const u = document.getElementById('username').value.trim();
      const e = document.getElementById('email').value.trim();
      const ph = document.getElementById('phone').value.trim();
      const p = document.getElementById('password').value;
      const pc = document.getElementById('confirmPassword').value;

      if(!u || !e || !ph || !p || !pc) return alert('Please fill in all fields');
      if(u.length < 3) return alert('Username must be at least 3 characters');
      if(p.length < 4) return alert('Password must be at least 4 characters');
      if(p !== pc) return alert('Passwords do not match');

      const users = loadUsers();
      if(users[u]) return alert('Username already exists. Choose another.');

      users[u] = { password: p, phone: ph, email: e };
      saveUsers(users);
      alert('Account created! You can now log in.');
      window.location = 'login.html';
    });
  </script>
</body>
</html>
